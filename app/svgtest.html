<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TEST DAT SVG SON</title>

  <script src="bower_components/snap.svg/dist/snap.svg.js"></script>

  <script>

    function randomByte() {
      return (Math.floor(Math.random() * (0xFF)));
    }

    function randomColor() {
      var colorString = '#';
      for (var i = 0; i < 3; i++) {
        var byteString = randomByte().toString(16);
        if (byteString.length < 2) {
          byteString = '0' + byteString;
        }
        colorString = colorString.concat(byteString);
      }

      return colorString;
    }

  </script>

</head>

<body>

<svg version="1.1"
     id="test"
     xmlns="http://www.w3.org/2000/svg"
     x="0px"
     y="0px"
	 width="512px"
     height="512px"
     viewBox="0 0 512 512"
     xml:space="preserve">
  </svg>

<script type="application/javascript">

  var paper = Snap.select("#test");


  var centerX = 250;
  var centerY = 250;
  var radius = 100;

  var circle = paper.circle(centerX, centerY, radius);

  var desiredWidth = 50;
  var desiredHeight = 100;

  var theta = Math.asin((1 - ((Math.pow(desiredWidth, 2) / (2 * Math.pow(radius, 2)))))) / 2;

  var rstheta = radius * Math.sin(theta);
  var rctheta = radius * Math.cos(theta);

  var height = radius + desiredHeight;

  var pointFiveRadians = Snap.rad(45);

  var Point = function (x, y) {
    this.x = x;
    this.y = y;

    this.transform = function (transformationMatrix) {
      return new Point(
        transformationMatrix.x(x, y),
        transformationMatrix.y(x, y)
      );
    }

  };

  var Triangle = function (b1, b2, h) {
    this.b1 = b1;
    this.b2 = b2;
    this.h = h;

    this.transform = function (transformationMatrix) {
      return new Triangle(
        b1.transform(transformationMatrix),
        b2.transform(transformationMatrix),
        h.transform(transformationMatrix)
      );
    };

    this.toPath = function () {
      return [b1.x, b1.y, b2.x, b2.y, h.x, h.y];
    }

  };

  var basePoint1 = new Point(centerX + rctheta, centerY + rstheta);
  var basePoint2 = new Point(centerX + rstheta, centerY + rctheta);
  var topPoint = new Point(centerX + height * Math.cos(pointFiveRadians), centerY + height * Math.sin(pointFiveRadians));
  var templateTriangle = new Triangle(basePoint1, basePoint2, topPoint);

  var topRightRotator = new Snap.Matrix().rotate(-110, centerX, centerY);
  var bottomLeftRotator = new Snap.Matrix().rotate(70, centerX, centerY);

  var topRightTriangle = paper.polygon(templateTriangle.transform(topRightRotator).toPath());
  var bottomLeftTriangle = paper.polygon(templateTriangle.transform(bottomLeftRotator).toPath());


  var triangleSet = new Snap.Set([topRightTriangle, bottomLeftTriangle]);


  var rotation = -45;
  function increaseRotation() {
    rotation = (rotation - 45);
    console.log(rotation);
  }
  increaseRotation();
  function animateTriangles() {
    triangleSet.animate(
      {
        transform: 'r' + rotation + ',' + centerX + ',' + centerY
      },
      500,
      mina.easeout,
      function loopTriangles() {

        if (rotation === 0) {
          triangleSet.attr({
            transform: 'r' + rotation + ',' + centerX + ',' + centerY
          });
        }


        increaseRotation();
        animateTriangles();
      }
    );
  }

  Snap.filter.turbulence = function () {
    return '<feTurbulence stitchTiles="stitch"  baseFrequency="0.05" numOctaves="2" type="fractalNoise"/>';
  };


  var group = paper.group(circle, bottomLeftTriangle, topRightTriangle);


  var blurFilter = Snap.filter.blur(5, 10);

  var darkenFilter = Snap.filter.brightness(0);
  var contrastFilter = Snap.filter.contrast(1);


  var blurAndTurbulence = paper.filter([
      blurFilter,
      Snap.filter.turbulence()
    ].join('\n')
  );


  var comboFilter = paper.filter([
      blurFilter,
      darkenFilter,
      contrastFilter
    ].join('\n')
  );

  var blurChild = comboFilter.node.childNodes[0];
  var hueRotateChild = comboFilter.node.childNodes[6];
  var turbulenceChild = blurAndTurbulence.node.childNodes[2];


  function randomTranslate() {
    group.animate(
      {
        transform: 't' + Math.random() * 5 + ',' + Math.random() * 5
      },
      123,
//      mina.bounce,
      function loopTranslate() {
        randomTranslate();
      }
    );
  }
  //    randomTranslate();


  function randomBlur() {
    return Math.random() * 16 + 4;
  }
  var blurStart = randomBlur();
  var blurStop = randomBlur();

  function alterBlur(value) {
    var value2 = value + ',' + value;
    blurAndTurbulence.node.firstChild.attributes[0].value = value2;
    blurChild.attributes[0].value = value2;
    turbulenceChild.attributes[1].value = value + ',' + value;

    clone.attr({fill: randomColor()});
  }

  function animateBlurIn() {

    blurStop = randomBlur();

    Snap.animate(
      blurStart,
      blurStop,
      alterBlur,
      1000,
//      mina.bounce,
      function () {
        animateBlurOut();
      });
  }

  function animateBlurOut() {
    blurStart = randomBlur();

    Snap.animate(
      blurStop,
      blurStart,
      alterBlur,
      1000,
//      mina.bounce,
      function () {
        animateBlurIn();
      });
  }

  var clone = group.clone();

  clone.attr({
    transform: 's30',
    fill: '#FFFFFF',
    filter: blurAndTurbulence
  });

  group.attr({
    mask: clone,
    fill: '#000',
    filter: comboFilter
  });

  animateBlurIn();


</script>

</body>

</html>
